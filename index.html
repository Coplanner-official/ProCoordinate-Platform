<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProCoordinate - Construction Management Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .nav-item {
            padding: 12px 16px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item:hover {
            background: #f3f4f6;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .content-area {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #1f2937;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #4b5563;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th {
            background: #f9fafb;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 2px solid #e5e7eb;
        }

        .table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
        }

        .table tr:hover {
            background: #f9fafb;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        .close-btn:hover {
            color: #374151;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .status-open {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-approved {
            background: #d1fae5;
            color: #065f46;
        }

        .status-rejected {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-closed {
            background: #e5e7eb;
            color: #374151;
        }

        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }

        .card-meta {
            color: #6b7280;
            font-size: 14px;
            margin-top: 5px;
        }

        .card-actions {
            display: flex;
            gap: 5px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            color: #6b7280;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            color: #374151;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 10px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #374151;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .photo-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .photo-card:hover {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .photo-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .photo-info {
            padding: 15px;
        }

        .message-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            background: #f9fafb;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .message-author {
            font-weight: 600;
            color: #1f2937;
        }

        .message-time {
            color: #6b7280;
            font-size: 12px;
        }

        .message-input {
            display: flex;
            gap: 10px;
        }

        .message-input input {
            flex: 1;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .empty-state-text {
            font-size: 14px;
            margin-bottom: 20px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1f2937;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
            z-index: 2000;
            animation: slideIn 0.3s ease;
        }

        .toast.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .file-upload {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f9fafb;
        }

        .file-upload.dragover {
            border-color: #667eea;
            background: #ede9fe;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            padding: 20px;
            color: white;
        }

        .stat-card-title {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card-value {
            font-size: 32px;
            font-weight: bold;
        }

        .stat-card-change {
            font-size: 12px;
            margin-top: 5px;
            opacity: 0.9;
        }

        .activity-feed {
            margin-top: 20px;
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-left: 3px solid transparent;
            transition: all 0.3s;
        }

        .activity-item:hover {
            background: #f9fafb;
            border-left-color: #667eea;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .activity-description {
            color: #6b7280;
            font-size: 14px;
        }

        .activity-time {
            color: #9ca3af;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ProCoordinate</div>
            <div class="user-info">
                <span id="currentProjectName">Select a Project</span>
                <button class="btn btn-secondary" onclick="app.showProjectSelector()">Switch Project</button>
                <button class="btn btn-primary" onclick="app.createProject()">+ New Project</button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="nav-item active" onclick="app.navigate('dashboard')">
                    <span>üìä</span> Dashboard
                </div>
                <div class="nav-item" onclick="app.navigate('drawings')">
                    <span>üìê</span> Drawings
                </div>
                <div class="nav-item" onclick="app.navigate('rfis')">
                    <span>‚ùì</span> RFIs
                </div>
                <div class="nav-item" onclick="app.navigate('submittals')">
                    <span>üìù</span> Submittals
                </div>
                <div class="nav-item" onclick="app.navigate('dailylogs')">
                    <span>üìÖ</span> Daily Logs
                </div>
                <div class="nav-item" onclick="app.navigate('photos')">
                    <span>üì∏</span> Photos
                </div>
                <div class="nav-item" onclick="app.navigate('safety')">
                    <span>‚ö†Ô∏è</span> Safety Reports
                </div>
                <div class="nav-item" onclick="app.navigate('messages')">
                    <span>üí¨</span> Messages
                </div>
            </div>

            <div class="content-area" id="contentArea">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent">
            <!-- Modal content will be loaded dynamically -->
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // Main Application
        const app = {
            currentProject: null,
            currentSection: 'dashboard',
            data: {
                projects: [],
                drawings: [],
                rfis: [],
                submittals: [],
                dailyLogs: [],
                photos: [],
                safetyReports: [],
                messages: []
            },

            init() {
                this.loadData();
                if (this.data.projects.length > 0) {
                    this.currentProject = this.data.projects[0];
                    this.updateProjectDisplay();
                }
                this.navigate('dashboard');
            },

            loadData() {
                const savedData = localStorage.getItem('proCoordinateData');
                if (savedData) {
                    this.data = JSON.parse(savedData);
                } else {
                    // Initialize with sample data
                    this.data = {
                        projects: [
                            {
                                id: this.generateId(),
                                name: 'Downtown Office Complex',
                                client: 'ABC Corporation',
                                status: 'active',
                                startDate: '2024-01-15',
                                endDate: '2024-12-31',
                                manager: 'John Smith',
                                value: 5000000,
                                completion: 35
                            }
                        ],
                        drawings: [],
                        rfis: [],
                        submittals: [],
                        dailyLogs: [],
                        photos: [],
                        safetyReports: [],
                        messages: []
                    };
                    this.saveData();
                }
            },

            saveData() {
                localStorage.setItem('proCoordinateData', JSON.stringify(this.data));
            },

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            },

            showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            },

            navigate(section) {
                this.currentSection = section;
                
                // Update navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.closest('.nav-item').classList.add('active');

                // Load content
                const contentArea = document.getElementById('contentArea');
                
                switch(section) {
                    case 'dashboard':
                        this.loadDashboard();
                        break;
                    case 'drawings':
                        this.loadDrawings();
                        break;
                    case 'rfis':
                        this.loadRFIs();
                        break;
                    case 'submittals':
                        this.loadSubmittals();
                        break;
                    case 'dailylogs':
                        this.loadDailyLogs();
                        break;
                    case 'photos':
                        this.loadPhotos();
                        break;
                    case 'safety':
                        this.loadSafetyReports();
                        break;
                    case 'messages':
                        this.loadMessages();
                        break;
                }
            },

            loadDashboard() {
                const projectData = this.getProjectData();
                const contentArea = document.getElementById('contentArea');
                
                contentArea.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title">Project Dashboard</h2>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-card-title">Total RFIs</div>
                            <div class="stat-card-value">${projectData.rfis.length}</div>
                            <div class="stat-card-change">
                                ${projectData.rfis.filter(r => r.status === 'open').length} Open
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-title">Submittals</div>
                            <div class="stat-card-value">${projectData.submittals.length}</div>
                            <div class="stat-card-change">
                                ${projectData.submittals.filter(s => s.status === 'pending').length} Pending
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-title">Drawings</div>
                            <div class="stat-card-value">${projectData.drawings.length}</div>
                            <div class="stat-card-change">Latest revision available</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-card-title">Safety Reports</div>
                            <div class="stat-card-value">${projectData.safetyReports.length}</div>
                            <div class="stat-card-change">This month</div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px; margin-bottom: 20px;">Recent Activity</h3>
                    <div class="activity-feed" id="activityFeed">
                        ${this.getRecentActivity()}
                    </div>
                `;
            },

            getRecentActivity() {
                const activities = [];
                
                // Gather all activities
                this.data.rfis.forEach(rfi => {
                    if (rfi.projectId === this.currentProject?.id) {
                        activities.push({
                            type: 'rfi',
                            title: `RFI #${rfi.number} created`,
                            description: rfi.question.substring(0, 100) + '...',
                            date: rfi.dateSubmitted,
                            icon: '‚ùì'
                        });
                    }
                });
                
                this.data.submittals.forEach(submittal => {
                    if (submittal.projectId === this.currentProject?.id) {
                        activities.push({
                            type: 'submittal',
                            title: `Submittal: ${submittal.title}`,
                            description: `Status: ${submittal.status}`,
                            date: submittal.dateSubmitted,
                            icon: 'üìù'
                        });
                    }
                });
                
                // Sort by date
                activities.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Return formatted HTML
                if (activities.length === 0) {
                    return `
                        <div class="empty-state">
                            <div class="empty-state-text">No recent activity</div>
                        </div>
                    `;
                }
                
                return activities.slice(0, 10).map(activity => `
                    <div class="activity-item">
                        <div class="activity-icon">${activity.icon}</div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.title}</div>
                            <div class="activity-description">${activity.description}</div>
                            <div class="activity-time">${this.formatDate(activity.date)}</div>
                        </div>
                    </div>
                `).join('');
            },

            loadDrawings() {
                const projectData = this.getProjectData();
                const contentArea = document.getElementById('contentArea');
                
                contentArea.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title">Drawings</h2>
                        <button class="btn btn-primary" onclick="app.showDrawingForm()">+ Add Drawing</button>
                    </div>
                    
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Number</th>
                                <th>Title</th>
                                <th>Revision</th>
                                <th>Date</th>
                                <th>Discipline</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${projectData.drawings.map(drawing => `
                                <tr>
                                    <td>${drawing.number}</td>
                                    <td>${drawing.title}</td>
                                    <td>${drawing.revision}</td>
                                    <td>${this.formatDate(drawing.date)}</td>
                                    <td>${drawing.discipline}</td>
                                    <td>
                                        <button class="icon-btn" onclick="app.editDrawing('${drawing.id}')">‚úèÔ∏è</button>
                                        <button class="icon-btn" onclick="app.deleteDrawing('${drawing.id}')">üóëÔ∏è</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    ${projectData.drawings.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìê</div>
                            <div class="empty-state-title">No drawings yet</div>
                            <div class="empty-state-text">Add your first drawing to get started</div>
                        </div>
                    ` : ''}
                `;
            },

            loadRFIs() {
                const projectData = this.getProjectData();
                const contentArea = document.getElementById('contentArea');
                
                contentArea.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title">RFIs (Request for Information)</h2>
                        <button class="btn btn-primary" onclick="app.showRFIForm()">+ Create RFI</button>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab active" onclick="app.filterRFIs('all', this)">All RFIs</button>
                        <button class="tab" onclick="app.filterRFIs('open', this)">Open</button>
                        <button class="tab" onclick="app.filterRFIs('closed', this)">Closed</button>
                    </div>
                    
                    <div id="rfiList">
                        ${projectData.rfis.map(rfi => `
                            <div class="card">
                                <div class="card-header">
                                    <div>
                                        <div class="card-title">RFI #${rfi.number}: ${rfi.subject}</div>
                                        <div class="card-meta">
                                            Submitted: ${this.formatDate(rfi.dateSubmitted)} | 
                                            To: ${rfi.assignedTo}
                                        </div>
                                    </div>
                                    <div class="card-actions">
                                        <span class="status-badge status-${rfi.status}">${rfi.status}</span>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; color: #6b7280;">
                                    ${rfi.question}
                                </div>
                                ${rfi.response ? `
                                    <div style="margin-top: 10px; padding: 10px; background: #f9fafb; border-radius: 6px;">
                                        <strong>Response:</strong> ${rfi.response}
                                    </div>
                                ` : ''}
                                <div style="margin-top: 15px; display: flex; gap: 10px;">
                                    <button class="btn btn-secondary" onclick="app.respondToRFI('${rfi.id}')">
                                        ${rfi.response ? 'Edit Response' : 'Add Response'}
                                    </button>
                                    <button class="btn btn-secondary" onclick="app.editRFI('${rfi.id}')">Edit</button>
                                    <button class="btn btn-danger" onclick="app.deleteRFI('${rfi.id}')">Delete</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${projectData.rfis.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-state-icon">‚ùì</div>
                            <div class="empty-state-title">No RFIs yet</div>
                            <div class="empty-state-text">Create your first RFI to get answers</div>
                        </div>
                    ` : ''}
                `;
            },

            loadSubmittals() {
                const projectData = this.getProjectData();
                const contentArea = document.getElementById('contentArea');
                
                contentArea.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title">Submittals</h2>
                        <button class="btn btn-primary" onclick="app.showSubmittalForm()">+ New Submittal</button>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab active" onclick="app.filterSubmittals('all', this)">All</button>
                        <button class="tab" onclick="app.filterSubmittals('pending', this)">Pending</button>
                        <button class="tab" onclick="app.filterSubmittals('approved', this)">Approved</button>
                        <button class="tab" onclick="app.filterSubmittals('rejected', this)">Rejected</button>
                    </div>
                    
                    <div id="submittalList">
                        ${projectData.submittals.map(submittal => `
                            <div class="card">
                                <div class="card-header">
                                    <div>
                                        <div class="card-title">${submittal.number}: ${submittal.title}</div>
                                        <div class="card-meta">
                                            Type: ${submittal.type} | 
                                            Submitted: ${this.formatDate(submittal.dateSubmitted)}
                                        </div>
                                    </div>
                                    <div class="card-actions">
                                        <span class="status-badge status-${submittal.status}">${submittal.status}</span>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; color: #6b7280;">
                                    ${submittal.description}
                                </div>
                                ${submittal.comments ? `
                                    <div style="margin-top: 10px; padding: 10px; background: #f9fafb; border-radius: 6px;">
                                        <strong>Comments:</strong> ${submittal.comments}
                                    </div>
                                ` : ''}
                                <div style="margin-top: 15px; display: flex; gap: 10px;">
                                    <button class="btn btn-success" onclick="app.updateSubmittalStatus('${submittal.id}', 'approved')">Approve</button>
                                    <button class="btn btn-danger" onclick="app.updateSubmittalStatus('${submittal.id}', 'rejected')">Reject</button>
                                    <button class="btn btn-secondary" onclick="app.editSubmittal('${submittal.id}')">Edit</button>
                                    <button class="btn btn-secondary" onclick="app.deleteSubmittal('${submittal.id}')">Delete</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${projectData.submittals.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìù</div>
                            <div class="empty-state-title">No submittals yet</div>
                            <div class="empty-state-text">Create your first submittal for approval</div>
                        </div>
                    ` : ''}
                `;
            },

            loadDailyLogs() {
                const projectData = this.getProjectData();
                const contentArea = document.getElementById('contentArea');
                
                contentArea.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title">Daily Logs</h2>
                        <button class="btn btn-primary" onclick="app.showDailyLogForm()">+ Add Daily Log</button>
                    </div>
                    
                    <div id="dailyLogsList">
                        ${projectData.dailyLogs.map(log => `
                            <div class="card">
                                <div class="card-header">
                                    <div>
                                        <div class="card-title">${this.formatDate(log.date)}</div>
                                        <div class="card-meta">
                                            Weather: ${log.weather} | 
                                            Workers: ${log.workers} | 
                                            Superintendent: ${log.superintendent}
                                        </div>
                                    </div>
                                    <div class="card-actions">
                                        <button class="icon-btn" onclick="app.editDailyLog('${log.id}')">‚úèÔ∏è</button>
                                        <button class="icon-btn" onclick="app.deleteDailyLog('${log.id}')">üóëÔ∏è</button>
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <strong>Work Performed:</strong>
                                    <p style="color: #6b7280; margin-top: 5px;">${log.workPerformed}</p>
                                </div>
                                ${log.issues ? `
                                    <div style="margin-top: 10px;">
                                        <strong>Issues:</strong>
                                        <p style="color: #ef4444; margin-top: 5px;">${log.issues}</p>
                                    </div>
                                ` : ''}
                                ${log.visitors ? `
                                    <div style="margin-top: 10px;">
                                        <strong>Visitors:</strong>
                                        <p style="color: #6b7280; margin-top: 5px;">${log.visitors}</p>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    ${projectData.dailyLogs.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìÖ</div>
                            <div class="empty-state-title">No daily logs yet</div>
                            <div class="empty-state-text">Start logging daily activities</div>
                        </div>
                    ` : ''}
                `;
            },

            loadPhotos() {
                const projectData = this.getProjectData();
                const contentArea = document.getElementById('contentArea');
                
                contentArea.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title">Photo Documentation</h2>
                        <button class="btn btn-primary" onclick="app.showPhotoUpload()">+ Upload Photos</button>
                    </div>
                    
                    <div class="grid">
                        ${projectData.photos.map(photo => `
                            <div class="photo-card">
                                <img src="${photo.url || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2U1ZTdlYiIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzZiNzI4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+UGhvdG8gUGxhY2Vob2xkZXI8L3RleHQ+Cjwvc3ZnPg=='}" alt="${photo.description}">
                                <div class="photo-info">
                                    <div style="font-weight: 600; margin-bottom: 5px;">${photo.title}</div>
                                    <div style="color: #6b7280; font-size: 14px; margin-bottom: 5px;">${photo.description}</div>
                                    <div style="color: #9ca3af; font-size: 12px;">
                                        ${this.formatDate(photo.date)} | ${photo.location}
                                    </div>
                                    <div style="margin-top: 10px; display: flex; gap: 5px;">
                                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;" 
                                                onclick="app.editPhoto('${photo.id}')">Edit</button>
                                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" 
                                                onclick="app.deletePhoto('${photo.id}')">Delete</button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${projectData.photos.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-state-icon">üì∏</div>
                            <div class="empty-state-title">No photos yet</div>
                            <div class="empty-state-text">Upload photos to document progress</div>
                        </div>
                    ` : ''}
                `;
            },

            loadSafetyReports() {
                const projectData = this.getProjectData();
                const contentArea = document.getElementById('contentArea');
                
                contentArea.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title">Safety Reports</h2>
                        <button class="btn btn-primary" onclick="app.showSafetyReportForm()">+ New Safety Report</button>
                    </div>
                    
                    <div id="safetyReportsList">
                        ${projectData.safetyReports.map(report => `
                            <div class="card">
                                <div class="card-header">
                                    <div>
                                        <div class="card-title">${report.type}: ${this.formatDate(report.date)}</div>
                                        <div class="card-meta">
                                            Reported by: ${report.reportedBy} | 
                                            Severity: <span style="color: ${report.severity === 'high' ? '#ef4444' : report.severity === 'medium' ? '#f59e0b' : '#10b981'}">
                                                ${report.severity}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="card-actions">
                                        <span class="status-badge status-${report.status}">${report.status}</span>
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <strong>Description:</strong>
                                    <p style="color: #6b7280; margin-top: 5px;">${report.description}</p>
                                </div>
                                ${report.actionTaken ? `
                                    <div style="margin-top: 10px;">
                                        <strong>Action Taken:</strong>
                                        <p style="color: #10b981; margin-top: 5px;">${report.actionTaken}</p>
                                    </div>
                                ` : ''}
                                <div style="margin-top: 15px; display: flex; gap: 10px;">
                                    <button class="btn btn-secondary" onclick="app.editSafetyReport('${report.id}')">Edit</button>
                                    <button class="btn ${report.status === 'resolved' ? 'btn-secondary' : 'btn-success'}" 
                                            onclick="app.updateSafetyStatus('${report.id}', '${report.status === 'resolved' ? 'open' : 'resolved'}')">
                                        Mark as ${report.status === 'resolved' ? 'Open' : 'Resolved'}
                                    </button>
                                    <button class="btn btn-danger" onclick="app.deleteSafetyReport('${report.id}')">Delete</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${projectData.safetyReports.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-state-icon">‚ö†Ô∏è</div>
                            <div class="empty-state-title">No safety reports</div>
                            <div class="empty-state-text">Report safety incidents and near-misses</div>
                        </div>
                    ` : ''}
                `;
            },

            loadMessages() {
                const projectData = this.getProjectData();
                const contentArea = document.getElementById('contentArea');
                
                contentArea.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title">Project Messages</h2>
                    </div>
                    
                    <div class="message-container">
                        ${projectData.messages.map(message => `
                            <div class="message">
                                <div class="message-header">
                                    <span class="message-author">${message.author}</span>
                                    <span class="message-time">${this.formatDate(message.timestamp)}</span>
                                </div>
                                <div>${message.content}</div>
                            </div>
                        `).join('')}
                        
                        ${projectData.messages.length === 0 ? `
                            <div class="empty-state">
                                <div class="empty-state-text">No messages yet. Start the conversation!</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="message-input">
                        <input type="text" class="form-input" id="messageInput" 
                               placeholder="Type your message..." 
                               onkeypress="if(event.key === 'Enter') app.sendMessage()">
                        <button class="btn btn-primary" onclick="app.sendMessage()">Send</button>
                    </div>
                `;
            },

            // Form Methods
            showProjectSelector() {
                const modal = document.getElementById('modal');
                const modalContent = document.getElementById('modalContent');
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">Select Project</h3>
                        <button class="close-btn" onclick="app.closeModal()">&times;</button>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${this.data.projects.map(project => `
                            <div class="card" style="cursor: pointer;" onclick="app.selectProject('${project.id}')">
                                <div class="card-title">${project.name}</div>
                                <div class="card-meta">Client: ${project.client} | Status: ${project.status}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                modal.classList.add('active');
            },

            selectProject(projectId) {
                this.currentProject = this.data.projects.find(p => p.id === projectId);
                this.updateProjectDisplay();
                this.closeModal();
                this.navigate('dashboard');
                this.showToast('Project switched successfully');
            },

            createProject() {
                const modal = document.getElementById('modal');
                const modalContent = document.getElementById('modalContent');
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">Create New Project</h3>
                        <button class="close-btn" onclick="app.closeModal()">&times;</button>
                    </div>
                    
                    <form onsubmit="app.saveProject(event)">
                        <div class="form-group">
                            <label class="form-label">Project Name *</label>
                            <input type="text" class="form-input" name="name" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Client *</label>
                            <input type="text" class="form-input" name="client" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Project Manager</label>
                            <input type="text" class="form-input" name="manager">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Start Date</label>
                            <input type="date" class="form-input" name="startDate">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">End Date</label>
                            <input type="date" class="form-input" name="endDate">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Project Value</label>
                            <input type="number" class="form-input" name="value" step="1000">
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Create Project</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
            },

            saveProject(event) {
                event.preventDefault();
                const formData = new FormData(event.target);
                
                const project = {
                    id: this.generateId(),
                    name: formData.get('name'),
                    client: formData.get('client'),
                    manager: formData.get('manager') || 'Not Assigned',
                    startDate: formData.get('startDate'),
                    endDate: formData.get('endDate'),
                    value: parseFloat(formData.get('value')) || 0,
                    status: 'active',
                    completion: 0
                };
                
                this.data.projects.push(project);
                this.currentProject = project;
                this.saveData();
                this.updateProjectDisplay();
                this.closeModal();
                this.showToast('Project created successfully');
                this.navigate('dashboard');
            },

            showDrawingForm(drawingId = null) {
                const modal = document.getElementById('modal');
                const modalContent = document.getElementById('modalContent');
                const drawing = drawingId ? this.data.drawings.find(d => d.id === drawingId) : null;
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">${drawing ? 'Edit' : 'Add'} Drawing</h3>
                        <button class="close-btn" onclick="app.closeModal()">&times;</button>
                    </div>
                    
                    <form onsubmit="app.saveDrawing(event, '${drawingId || ''}')">
                        <div class="form-group">
                            <label class="form-label">Drawing Number *</label>
                            <input type="text" class="form-input" name="number" value="${drawing?.number || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Title *</label>
                            <input type="text" class="form-input" name="title" value="${drawing?.title || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Revision</label>
                            <input type="text" class="form-input" name="revision" value="${drawing?.revision || 'A'}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Discipline</label>
                            <select class="form-select" name="discipline">
                                <option value="Architectural" ${drawing?.discipline === 'Architectural' ? 'selected' : ''}>Architectural</option>
                                <option value="Structural" ${drawing?.discipline === 'Structural' ? 'selected' : ''}>Structural</option>
                                <option value="Mechanical" ${drawing?.discipline === 'Mechanical' ? 'selected' : ''}>Mechanical</option>
                                <option value="Electrical" ${drawing?.discipline === 'Electrical' ? 'selected' : ''}>Electrical</option>
                                <option value="Plumbing" ${drawing?.discipline === 'Plumbing' ? 'selected' : ''}>Plumbing</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">${drawing ? 'Update' : 'Add'} Drawing</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
            },

            saveDrawing(event, drawingId) {
                event.preventDefault();
                const formData = new FormData(event.target);
                
                if (drawingId) {
                    // Edit existing
                    const index = this.data.drawings.findIndex(d => d.id === drawingId);
                    if (index !== -1) {
                        this.data.drawings[index] = {
                            ...this.data.drawings[index],
                            number: formData.get('number'),
                            title: formData.get('title'),
                            revision: formData.get('revision'),
                            discipline: formData.get('discipline')
                        };
                    }
                } else {
                    // Create new
                    const drawing = {
                        id: this.generateId(),
                        projectId: this.currentProject.id,
                        number: formData.get('number'),
                        title: formData.get('title'),
                        revision: formData.get('revision'),
                        discipline: formData.get('discipline'),
                        date: new Date().toISOString()
                    };
                    this.data.drawings.push(drawing);
                }
                
                this.saveData();
                this.closeModal();
                this.showToast(`Drawing ${drawingId ? 'updated' : 'added'} successfully`);
                this.loadDrawings();
            },

            showRFIForm(rfiId = null) {
                const modal = document.getElementById('modal');
                const modalContent = document.getElementById('modalContent');
                const rfi = rfiId ? this.data.rfis.find(r => r.id === rfiId) : null;
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">${rfi ? 'Edit' : 'Create'} RFI</h3>
                        <button class="close-btn" onclick="app.closeModal()">&times;</button>
                    </div>
                    
                    <form onsubmit="app.saveRFI(event, '${rfiId || ''}')">
                        <div class="form-group">
                            <label class="form-label">RFI Number *</label>
                            <input type="text" class="form-input" name="number" value="${rfi?.number || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Subject *</label>
                            <input type="text" class="form-input" name="subject" value="${rfi?.subject || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Question *</label>
                            <textarea class="form-textarea" name="question" required>${rfi?.question || ''}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Assigned To *</label>
                            <input type="text" class="form-input" name="assignedTo" value="${rfi?.assignedTo || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Priority</label>
                            <select class="form-select" name="priority">
                                <option value="low" ${rfi?.priority === 'low' ? 'selected' : ''}>Low</option>
                                <option value="medium" ${rfi?.priority === 'medium' ? 'selected' : ''}>Medium</option>
                                <option value="high" ${rfi?.priority === 'high' ? 'selected' : ''}>High</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">${rfi ? 'Update' : 'Create'} RFI</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
            },

            saveRFI(event, rfiId) {
                event.preventDefault();
                const formData = new FormData(event.target);
                
                if (rfiId) {
                    // Edit existing
                    const index = this.data.rfis.findIndex(r => r.id === rfiId);
                    if (index !== -1) {
                        this.data.rfis[index] = {
                            ...this.data.rfis[index],
                            number: formData.get('number'),
                            subject: formData.get('subject'),
                            question: formData.get('question'),
                            assignedTo: formData.get('assignedTo'),
                            priority: formData.get('priority')
                        };
                    }
                } else {
                    // Create new
                    const rfi = {
                        id: this.generateId(),
                        projectId: this.currentProject.id,
                        number: formData.get('number'),
                        subject: formData.get('subject'),
                        question: formData.get('question'),
                        assignedTo: formData.get('assignedTo'),
                        priority: formData.get('priority'),
                        status: 'open',
                        dateSubmitted: new Date().toISOString(),
                        response: ''
                    };
                    this.data.rfis.push(rfi);
                }
                
                this.saveData();
                this.closeModal();
                this.showToast(`RFI ${rfiId ? 'updated' : 'created'} successfully`);
                this.loadRFIs();
            },

            respondToRFI(rfiId) {
                const rfi = this.data.rfis.find(r => r.id === rfiId);
                if (!rfi) return;
                
                const modal = document.getElementById('modal');
                const modalContent = document.getElementById('modalContent');
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">Response to RFI #${rfi.number}</h3>
                        <button class="close-btn" onclick="app.closeModal()">&times;</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <strong>Question:</strong>
                        <p style="color: #6b7280; margin-top: 5px;">${rfi.question}</p>
                    </div>
                    
                    <form onsubmit="app.saveRFIResponse(event, '${rfiId}')">
                        <div class="form-group">
                            <label class="form-label">Response *</label>
                            <textarea class="form-textarea" name="response" required>${rfi.response || ''}</textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Response</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
            },

            saveRFIResponse(event, rfiId) {
                event.preventDefault();
                const formData = new FormData(event.target);
                
                const index = this.data.rfis.findIndex(r => r.id === rfiId);
                if (index !== -1) {
                    this.data.rfis[index].response = formData.get('response');
                    this.data.rfis[index].status = 'closed';
                    this.data.rfis[index].dateResponded = new Date().toISOString();
                }
                
                this.saveData();
                this.closeModal();
                this.showToast('RFI response saved');
                this.loadRFIs();
            },

            showSubmittalForm(submittalId = null) {
                const modal = document.getElementById('modal');
                const modalContent = document.getElementById('modalContent');
                const submittal = submittalId ? this.data.submittals.find(s => s.id === submittalId) : null;
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">${submittal ? 'Edit' : 'New'} Submittal</h3>
                        <button class="close-btn" onclick="app.closeModal()">&times;</button>
                    </div>
                    
                    <form onsubmit="app.saveSubmittal(event, '${submittalId || ''}')">
                        <div class="form-group">
                            <label class="form-label">Submittal Number *</label>
                            <input type="text" class="form-input" name="number" value="${submittal?.number || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Title *</label>
                            <input type="text" class="form-input" name="title" value="${submittal?.title || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Type</label>
                            <select class="form-select" name="type">
                                <option value="Material" ${submittal?.type === 'Material' ? 'selected' : ''}>Material</option>
                                <option value="Shop Drawing" ${submittal?.type === 'Shop Drawing' ? 'selected' : ''}>Shop Drawing</option>
                                <option value="Product Data" ${submittal?.type === 'Product Data' ? 'selected' : ''}>Product Data</option>
                                <option value="Sample" ${submittal?.type === 'Sample' ? 'selected' : ''}>Sample</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" name="description">${submittal?.description || ''}</textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">${submittal ? 'Update' : 'Create'} Submittal</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
            },

            saveSubmittal(event, submittalId) {
                event.preventDefault();
                const formData = new FormData(event.target);
                
                if (submittalId) {
                    // Edit existing
                    const index = this.data.submittals.findIndex(s => s.id === submittalId);
                    if (index !== -1) {
                        this.data.submittals[index] = {
                            ...this.data.submittals[index],
                            number: formData.get('number'),
                            title: formData.get('title'),
                            type: formData.get('type'),
                            description: formData.get('description')
                        };
                    }
                } else {
                    // Create new
                    const submittal = {
                        id: this.generateId(),
                        projectId: this.currentProject.id,
                        number: formData.get('number'),
                        title: formData.get('title'),
                        type: formData.get('type'),
                        description: formData.get('description'),
                        status: 'pending',
                        dateSubmitted: new Date().toISOString(),
                        comments: ''
                    };
                    this.data.submittals.push(submittal);
                }
                
                this.saveData();
                this.closeModal();
                this.showToast(`Submittal ${submittalId ? 'updated' : 'created'} successfully`);
                this.loadSubmittals();
            },

            updateSubmittalStatus(submittalId, status) {
                const index = this.data.submittals.findIndex(s => s.id === submittalId);
                if (index !== -1) {
                    this.data.submittals[index].status = status;
                    this.saveData();
                    this.showToast(`Submittal ${status}`);
                    this.loadSubmittals();
                }
            },

            showDailyLogForm(logId = null) {
                const modal = document.getElementById('modal');
                const modalContent = document.getElementById('modalContent');
                const log = logId ? this.data.dailyLogs.find(l => l.id === logId) : null;
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">${log ? 'Edit' : 'Add'} Daily Log</h3>
                        <button class="close-btn" onclick="app.closeModal()">&times;</button>
                    </div>
                    
                    <form onsubmit="app.saveDailyLog(event, '${logId || ''}')">
                        <div class="form-group">
                            <label class="form-label">Date *</label>
                            <input type="date" class="form-input" name="date" value="${log?.date || new Date().toISOString().split('T')[0]}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Weather</label>
                            <input type="text" class="form-input" name="weather" value="${log?.weather || ''}" placeholder="e.g., Sunny, 75¬∞F">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Number of Workers</label>
                            <input type="number" class="form-input" name="workers" value="${log?.workers || ''}" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Superintendent</label>
                            <input type="text" class="form-input" name="superintendent" value="${log?.superintendent || ''}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Work Performed *</label>
                            <textarea class="form-textarea" name="workPerformed" required>${log?.workPerformed || ''}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Issues/Delays</label>
                            <textarea class="form-textarea" name="issues">${log?.issues || ''}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Visitors</label>
                            <textarea class="form-textarea" name="visitors" placeholder="List any site visitors">${log?.visitors || ''}</textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">${log ? 'Update' : 'Add'} Log</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
            },

            saveDailyLog(event, logId) {
                event.preventDefault();
                const formData = new FormData(event.target);
                
                if (logId) {
                    // Edit existing
                    const index = this.data.dailyLogs.findIndex(l => l.id === logId);
                    if (index !== -1) {
                        this.data.dailyLogs[index] = {
                            ...this.data.dailyLogs[index],
                            date: formData.get('date'),
                            weather: formData.get('weather'),
                            workers: formData.get('workers'),
                            superintendent: formData.get('superintendent'),
                            workPerformed: formData.get('workPerformed'),
                            issues: formData.get('issues'),
                            visitors: formData.get('visitors')
                        };
                    }
                } else {
                    // Create new
                    const log = {
                        id: this.generateId(),
                        projectId: this.currentProject.id,
                        date: formData.get('date'),
                        weather: formData.get('weather'),
                        workers: formData.get('workers'),
                        superintendent: formData.get('superintendent'),
                        workPerformed: formData.get('workPerformed'),
                        issues: formData.get('issues'),
                        visitors: formData.get('visitors')
                    };
                    this.data.dailyLogs.push(log);
                }
                
                this.saveData();
                this.closeModal();
                this.showToast(`Daily log ${logId ? 'updated' : 'added'} successfully`);
                this.loadDailyLogs();
            },

            showPhotoUpload(photoId = null) {
                const modal = document.getElementById('modal');
                const modalContent = document.getElementById('modalContent');
                const photo = photoId ? this.data.photos.find(p => p.id === photoId) : null;
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">${photo ? 'Edit' : 'Upload'} Photo</h3>
                        <button class="close-btn" onclick="app.closeModal()">&times;</button>
                    </div>
                    
                    <form onsubmit="app.savePhoto(event, '${photoId || ''}')">
                        ${!photo ? `
                            <div class="form-group">
                                <label class="form-label">Photo</label>
                                <div class="file-upload" onclick="document.getElementById('photoFile').click()">
                                    <div>üì∏ Click to upload or drag and drop</div>
                                    <div style="font-size: 12px; color: #9ca3af; margin-top: 5px;">PNG, JPG up to 10MB</div>
                                </div>
                                <input type="file" id="photoFile" name="file" accept="image/*" style="display: none;">
                            </div>
                        ` : ''}
                        
                        <div class="form-group">
                            <label class="form-label">Title *</label>
                            <input type="text" class="form-input" name="title" value="${photo?.title || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" name="description">${photo?.description || ''}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-input" name="location" value="${photo?.location || ''}" placeholder="e.g., Building A - 3rd Floor">
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">${photo ? 'Update' : 'Upload'} Photo</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
            },

            savePhoto(event, photoId) {
                event.preventDefault();
                const formData = new FormData(event.target);
                
                if (photoId) {
                    // Edit existing
                    const index = this.data.photos.findIndex(p => p.id === photoId);
                    if (index !== -1) {
                        this.data.photos[index] = {
                            ...this.data.photos[index],
                            title: formData.get('title'),
                            description: formData.get('description'),
                            location: formData.get('location')
                        };
                    }
                } else {
                    // Create new
                    const photo = {
                        id: this.generateId(),
                        projectId: this.currentProject.id,
                        title: formData.get('title'),
                        description: formData.get('description'),
                        location: formData.get('location'),
                        date: new Date().toISOString(),
                        url: '' // In real app, would handle file upload
                    };
                    this.data.photos.push(photo);
                }
                
                this.saveData();
                this.closeModal();
                this.showToast(`Photo ${photoId ? 'updated' : 'uploaded'} successfully`);
                this.loadPhotos();
            },

            showSafetyReportForm(reportId = null) {
                const modal = document.getElementById('modal');
                const modalContent = document.getElementById('modalContent');
                const report = reportId ? this.data.safetyReports.find(r => r.id === reportId) : null;
                
                modalContent.innerHTML = `
                    <div class="modal-header">
                        <h3 class="modal-title">${report ? 'Edit' : 'New'} Safety Report</h3>
                        <button class="close-btn" onclick="app.closeModal()">&times;</button>
                    </div>
                    
                    <form onsubmit="app.saveSafetyReport(event, '${reportId || ''}')">
                        <div class="form-group">
                            <label class="form-label">Type *</label>
                            <select class="form-select" name="type" required>
                                <option value="">Select type</option>
                                <option value="Incident" ${report?.type === 'Incident' ? 'selected' : ''}>Incident</option>
                                <option value="Near Miss" ${report?.type === 'Near Miss' ? 'selected' : ''}>Near Miss</option>
                                <option value="Hazard" ${report?.type === 'Hazard' ? 'selected' : ''}>Hazard</option>
                                <option value="Inspection" ${report?.type === 'Inspection' ? 'selected' : ''}>Inspection</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Date *</label>
                            <input type="date" class="form-input" name="date" value="${report?.date || new Date().toISOString().split('T')[0]}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Severity *</label>
                            <select class="form-select" name="severity" required>
                                <option value="low" ${report?.severity === 'low' ? 'selected' : ''}>Low</option>
                                <option value="medium" ${report?.severity === 'medium' ? 'selected' : ''}>Medium</option>
                                <option value="high" ${report?.severity === 'high' ? 'selected' : ''}>High</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Reported By *</label>
                            <input type="text" class="form-input" name="reportedBy" value="${report?.reportedBy || ''}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description *</label>
                            <textarea class="form-textarea" name="description" required>${report?.description || ''}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Action Taken</label>
                            <textarea class="form-textarea" name="actionTaken">${report?.actionTaken || ''}</textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary">${report ? 'Update' : 'Create'} Report</button>
                        </div>
                    </form>
                `;
                
                modal.classList.add('active');
            },

            saveSafetyReport(event, reportId) {
                event.preventDefault();
                const formData = new FormData(event.target);
                
                if (reportId) {
                    // Edit existing
                    const index = this.data.safetyReports.findIndex(r => r.id === reportId);
                    if (index !== -1) {
                        this.data.safetyReports[index] = {
                            ...this.data.safetyReports[index],
                            type: formData.get('type'),
                            date: formData.get('date'),
                            severity: formData.get('severity'),
                            reportedBy: formData.get('reportedBy'),
                            description: formData.get('description'),
                            actionTaken: formData.get('actionTaken')
                        };
                    }
                } else {
                    // Create new
                    const report = {
                        id: this.generateId(),
                        projectId: this.currentProject.id,
                        type: formData.get('type'),
                        date: formData.get('date'),
                        severity: formData.get('severity'),
                        reportedBy: formData.get('reportedBy'),
                        description: formData.get('description'),
                        actionTaken: formData.get('actionTaken'),
                        status: 'open'
                    };
                    this.data.safetyReports.push(report);
                }
                
                this.saveData();
                this.closeModal();
                this.showToast(`Safety report ${reportId ? 'updated' : 'created'} successfully`);
                this.loadSafetyReports();
            },

            updateSafetyStatus(reportId, status) {
                const index = this.data.safetyReports.findIndex(r => r.id === reportId);
                if (index !== -1) {
                    this.data.safetyReports[index].status = status;
                    this.saveData();
                    this.showToast(`Safety report marked as ${status}`);
                    this.loadSafetyReports();
                }
            },

            sendMessage() {
                const input = document.getElementById('messageInput');
                const content = input.value.trim();
                
                if (content) {
                    const message = {
                        id: this.generateId(),
                        projectId: this.currentProject.id,
                        author: 'Current User', // In real app, would use actual user
                        content: content,
                        timestamp: new Date().toISOString()
                    };
                    
                    this.data.messages.push(message);
                    this.saveData();
                    input.value = '';
                    this.loadMessages();
                }
            },

            // Delete Methods
            deleteDrawing(id) {
                if (confirm('Are you sure you want to delete this drawing?')) {
                    this.data.drawings = this.data.drawings.filter(d => d.id !== id);
                    this.saveData();
                    this.showToast('Drawing deleted');
                    this.loadDrawings();
                }
            },

            deleteRFI(id) {
                if (confirm('Are you sure you want to delete this RFI?')) {
                    this.data.rfis = this.data.rfis.filter(r => r.id !== id);
                    this.saveData();
                    this.showToast('RFI deleted');
                    this.loadRFIs();
                }
            },

            deleteSubmittal(id) {
                if (confirm('Are you sure you want to delete this submittal?')) {
                    this.data.submittals = this.data.submittals.filter(s => s.id !== id);
                    this.saveData();
                    this.showToast('Submittal deleted');
                    this.loadSubmittals();
                }
            },

            deleteDailyLog(id) {
                if (confirm('Are you sure you want to delete this daily log?')) {
                    this.data.dailyLogs = this.data.dailyLogs.filter(l => l.id !== id);
                    this.saveData();
                    this.showToast('Daily log deleted');
                    this.loadDailyLogs();
                }
            },

            deletePhoto(id) {
                if (confirm('Are you sure you want to delete this photo?')) {
                    this.data.photos = this.data.photos.filter(p => p.id !== id);
                    this.saveData();
                    this.showToast('Photo deleted');
                    this.loadPhotos();
                }
            },

            deleteSafetyReport(id) {
                if (confirm('Are you sure you want to delete this safety report?')) {
                    this.data.safetyReports = this.data.safetyReports.filter(r => r.id !== id);
                    this.saveData();
                    this.showToast('Safety report deleted');
                    this.loadSafetyReports();
                }
            },

            // Edit Methods
            editDrawing(id) {
                this.showDrawingForm(id);
            },

            editRFI(id) {
                this.showRFIForm(id);
            },

            editSubmittal(id) {
                this.showSubmittalForm(id);
            },

            editDailyLog(id) {
                this.showDailyLogForm(id);
            },

            editPhoto(id) {
                this.showPhotoUpload(id);
            },

            editSafetyReport(id) {
                this.showSafetyReportForm(id);
            },

            // Filter Methods
            filterRFIs(status, button) {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                button.classList.add('active');
                
                const projectData = this.getProjectData();
                const filtered = status === 'all' 
                    ? projectData.rfis 
                    : projectData.rfis.filter(r => r.status === status);
                
                // Re-render filtered RFIs
                const rfiList = document.getElementById('rfiList');
                rfiList.innerHTML = filtered.map(rfi => `
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">RFI #${rfi.number}: ${rfi.subject}</div>
                                <div class="card-meta">
                                    Submitted: ${this.formatDate(rfi.dateSubmitted)} | 
                                    To: ${rfi.assignedTo}
                                </div>
                            </div>
                            <div class="card-actions">
                                <span class="status-badge status-${rfi.status}">${rfi.status}</span>
                            </div>
                        </div>
                        <div style="margin-top: 10px; color: #6b7280;">
                            ${rfi.question}
                        </div>
                        ${rfi.response ? `
                            <div style="margin-top: 10px; padding: 10px; background: #f9fafb; border-radius: 6px;">
                                <strong>Response:</strong> ${rfi.response}
                            </div>
                        ` : ''}
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button class="btn btn-secondary" onclick="app.respondToRFI('${rfi.id}')">
                                ${rfi.response ? 'Edit Response' : 'Add Response'}
                            </button>
                            <button class="btn btn-secondary" onclick="app.editRFI('${rfi.id}')">Edit</button>
                            <button class="btn btn-danger" onclick="app.deleteRFI('${rfi.id}')">Delete</button>
                        </div>
                    </div>
                `).join('');
            },

            filterSubmittals(status, button) {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                button.classList.add('active');
                
                const projectData = this.getProjectData();
                const filtered = status === 'all' 
                    ? projectData.submittals 
                    : projectData.submittals.filter(s => s.status === status);
                
                // Re-render filtered submittals
                const submittalList = document.getElementById('submittalList');
                submittalList.innerHTML = filtered.map(submittal => `
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">${submittal.number}: ${submittal.title}</div>
                                <div class="card-meta">
                                    Type: ${submittal.type} | 
                                    Submitted: ${this.formatDate(submittal.dateSubmitted)}
                                </div>
                            </div>
                            <div class="card-actions">
                                <span class="status-badge status-${submittal.status}">${submittal.status}</span>
                            </div>
                        </div>
                        <div style="margin-top: 10px; color: #6b7280;">
                            ${submittal.description}
                        </div>
                        ${submittal.comments ? `
                            <div style="margin-top: 10px; padding: 10px; background: #f9fafb; border-radius: 6px;">
                                <strong>Comments:</strong> ${submittal.comments}
                            </div>
                        ` : ''}
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button class="btn btn-success" onclick="app.updateSubmittalStatus('${submittal.id}', 'approved')">Approve</button>
                            <button class="btn btn-danger" onclick="app.updateSubmittalStatus('${submittal.id}', 'rejected')">Reject</button>
                            <button class="btn btn-secondary" onclick="app.editSubmittal('${submittal.id}')">Edit</button>
                            <button class="btn btn-secondary" onclick="app.deleteSubmittal('${submittal.id}')">Delete</button>
                        </div>
                    </div>
                `).join('');
            },

            // Utility Methods
            getProjectData() {
                if (!this.currentProject) return { 
                    drawings: [], 
                    rfis: [], 
                    submittals: [], 
                    dailyLogs: [], 
                    photos: [], 
                    safetyReports: [], 
                    messages: [] 
                };
                
                return {
                    drawings: this.data.drawings.filter(d => d.projectId === this.currentProject.id),
                    rfis: this.data.rfis.filter(r => r.projectId === this.currentProject.id),
                    submittals: this.data.submittals.filter(s => s.projectId === this.currentProject.id),
                    dailyLogs: this.data.dailyLogs.filter(l => l.projectId === this.currentProject.id),
                    photos: this.data.photos.filter(p => p.projectId === this.currentProject.id),
                    safetyReports: this.data.safetyReports.filter(r => r.projectId === this.currentProject.id),
                    messages: this.data.messages.filter(m => m.projectId === this.currentProject.id)
                };
            },

            updateProjectDisplay() {
                const projectName = document.getElementById('currentProjectName');
                if (this.currentProject) {
                    projectName.textContent = this.currentProject.name;
                } else {
                    projectName.textContent = 'Select a Project';
                }
            },

            formatDate(dateString) {
                if (!dateString) return 'N/A';
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            },

            closeModal() {
                const modal = document.getElementById('modal');
                modal.classList.remove('active');
            }
        };

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
